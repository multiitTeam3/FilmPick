<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.w3.org/1999/xhtml"
      xmlns:c="http://www.w3.org/1999/XSL/Transform">
<html layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8">
    <title>ê²Œì‹œê¸€ ì¡°íšŒ</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/style.css}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script th:inline="javascript">
        $(function() {
            $('#b2').click(function() {
                $.ajax({
                    url: [[@{insertReply}]],
                    data: {
                        board_no : [[${board.boardNo}]],
                        member_no : [[${#authentication.principal.memberNo}]],
                        content : $('#reply').val()
                    },
                    success: function(response) {
                        $('#result').append(response);
                        $('#commentList').append(response); // Append new comment to the list
                        $('#reply').val('');
                        location.reload();
                    }
                });
            });


        });
    </script>
    <script>
        function replyUpdate(no, boardNo) {
        let comment = prompt("ìˆ˜ì •í•  ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”: ");
        if (comment !== null) {
            // Construct the URL for replyUpdate
            let updateUrl = '/community/updateReply?no=' + encodeURIComponent(no) + '&boardNo=' + encodeURIComponent(boardNo) + '&comment=' + encodeURIComponent(comment);
            location.href = updateUrl;
        } else {
            // Construct the URL for one
            let oneUrl = '/community/view?no=' + encodeURIComponent(boardNo);
            location.href = oneUrl;
        }
    }
    </script>
    <script>
        function updateLike(no, login){

            location.href="updateLike?no=" + no + "&login=" + login;
        }
    </script>
</head>
<body>
<div layout:fragment="content">
    <div class="container">
        <div class="card">
            <div class="card-header">
                <h2 class="text-center mb-4" th:text="${board.title}">ê²Œì‹œê¸€ ì œëª©</h2>
            </div>
            <hr color="grey">
            <div class="card-body">
                <div class="row" >
                    <div class="form-group col-md-6">
                        <label class="form-control">ê²Œì‹œê¸€ ë²ˆí˜¸: [[${board.boardNo}]]</label>
                    </div>
                    <div class="form-group col-md-6">
                        <label class="form-control">ì‘ì„±ì: [[${board.writer.userName}]]</label>
                    </div>
                </div>
                <div class="mb-3 form-group">
                    <label class="form-control">ì‘ì„±ì¼: [[${board.createDate}]]</label>
                </div>
                <div class="mb-3 form-group">
                    <label class="form-control" style="height:auto; padding: 10px;">ë‚´ìš©: <br> [[${board.content}]] <br>
                        <div th:if="${board.img != null}">
                            <img th:src="@{'/uploadFiles/' + ${board.img}}" width="250" height="250" alt="ê²Œì‹œê¸€ ì´ë¯¸ì§€" class="img-fluid">
                        </div>
                        <div th:if="${board.img == null}">
                            <p>ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                    </label>
                </div>
                <div style="margin-right:1px;" class="mt-4 text-center">
                    <button id="like_btn" class="btn btn-success" th:data-board-no="${board.boardNo}" th:data-member-no="${#authentication.principal.memberNo}" onclick="updateLike(this.getAttribute('data-board-no'), this.getAttribute('data-member-no'))" th:text="'ğŸ‘ì¶”ì²œ ' + ${board.likehit}">ì¶”ì²œ</button>
                </div>
                <div class="mt-4 text-right">
                    <a href="/community/list" class="btn btn-outline-primary">ëª©ë¡ìœ¼ë¡œ</a>
                    <div th:if="${#authentication.principal.memberNo == board.writer.memberNo}">
                        <br>
                        <a th:href="@{/community/updateBoard(no=${board.boardNo})}" class="btn btn-primary">ìˆ˜ì •</a>
                        <a th:href="@{/community/deleteBoard(no=${board.boardNo})}" class="btn btn-danger">ì‚­ì œ</a>
                    </div>
                </div>
            </div>
            <br>
        </div>
        <hr>
        <div id="result">
            <div th:each="re : ${list}">
                <b>ëŒ“ê¸€ <span th:text="${re.reply_no}"></span></b>
                <div class="text-right" th:if="${#authentication.principal.memberNo == re.member_no}">
                    <button id="no" class="btn btn-sm" th:data-reply-no="${re.reply_no}" th:data-board-no="${board.boardNo}" onclick="replyUpdate(this.getAttribute('data-reply-no'), this.getAttribute('data-board-no'))">ìˆ˜ì •</button>
                    <a th:href="@{/community/deleteReply(no=${re.reply_no}, boardNo=${board.boardNo})}">
                        <button id="b1" class="btn btn-sm">ì‚­ì œ</button>
                    </a>
                </div>
                <br>
                <span th:text="${re.content}"></span> <br>
                <hr>
            </div>
            <td class="t1">ëŒ“ê¸€</td>
            <td> <input id="reply" class="form-control" style="height:100px;" /> <br> <button id="b2" class="btn btn-primary">ì…ë ¥</button></td>
            <hr>
        </div>
    </div>

</div>

</body>


</html>